<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>ECサイト</title>
<link href="/css/style.css" th:href="@{/css/style.css}" rel="stylesheet" />
<script src="http://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet"
	href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script>
//	function Check(){
//		if(document.addUserForm.userName.value==""){
//			alert("User nameを入力してください。");
//				return false;
//		}

//		if(document.addUserForm.password.value==""){
//			alert("Passwordを入力してください。");
//				return false;
//		}
		
//		if(document.addUserForm.fullName.value==""){
//			alert("Full nameを入力してください。");
//				return false;
//		}
		
//	return true;
	
//	}


$(() => {
	$('button#checkUserName').on('click',() => {
	let userName = $('form#registerForm input[name=userName]').val();
		if(userName =="") return;
		checkUserName(userName);
	});
});

function checkUserName(userName) {
	$.ajax({
		type: 'POST',
		url: '/ecsite/duplicatedUserName',
		data: JSON.stringify({'userName': userName}),
		contentType: 'application/json',
		//datatype: 'json',
	})
	.then((result) => {
		if(result){
			alert('既に使われているため、使用できません。');
			$('span#checkOK').prop('class','hidden');
		} else {
			$('button#register').prop('disabled', false);
			$('span#checkOK').prop('class', 'info');
		}
	}, () => {
		alert('Error: ajax connection failed.');
	});
		
}
	
</script>
</head>

<body>
	<header>
		<h1>My EC Site -- Register page</h1>
	</header>

	<div id="adminPage">
		<h2>新規登録</h2>
	 		<form id ="registerForm" name="registerForm" method="POST"　action="/ecsite/registeUser">
	 			<p>User name：<input type="text" name="userName" /></p>
	 			<p>Password：<input type="text" name="password" /></p>
	 			<p>Full name：<input type="text" name="fullName" /></p>
	 			<button type="button" id="checkUserName">重複確認</button>
	 			<span id="checkOK" class="hidden">OK</span>
	 			<p><button type="submit" id="register">登録</button></p>
			</form>
	</div>

</body>
</html>